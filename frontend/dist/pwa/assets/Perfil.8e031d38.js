import{v as N,r as s,w as oe,x as h,y as k,z as t,B as e,M as U,Z as R,aM as me,X as M,G as D,Q as C,aN as re,Y,O as G,_ as O,H as W,I as X,F as b,a as Z,W as q,o as ve,A as pe,aO as ae}from"./index.a9495b3a.js";import{m as z,k as $,l as j,Q as F}from"./QDialog.1bcc0740.js";import{a as A,Q as fe}from"./QPage.deee6677.js";import{Q as se}from"./QList.2938740d.js";import{api as B}from"./axios.c798e365.js";import{a as _e}from"./utils.c3e36012.js";import{Q as ie,C as te}from"./ColecaoService.cdf7ac7c.js";import{A as ge}from"./AuthenticateService.c3e240d2.js";import{Q as I,a as S}from"./QCardSection.4cae44bf.js";import{Q as H}from"./QSeparator.6f3c39a3.js";import{Q as be}from"./QForm.2fc8931d.js";import{Q as ne}from"./QCardActions.dbb608c5.js";import{V as le}from"./ViaService.8dafdc9c.js";import"./scroll.3728f98d.js";class ye{async getById(o){try{return(await B.get(`/usuarios/${o}`)).data}catch(a){throw new Error(a.response.data.error||"Erro desconhecido ao buscar usu\xE1rio")}}async getAll(){try{return(await B.get("/usuarios")).data}catch(o){throw new Error(o.response.data.error||"Erro desconhecido ao buscar usu\xE1rios")}}async create(o,a,d){try{return(await B.post("/auth/register",{nome:o,email:a,password:d})).data}catch(n){throw n.response&&n.response.data&&n.response.data.error?new Error(n.response.data.error):new Error("Erro desconhecido ao criar usu\xE1rio")}}async getPerfil(){var o;try{const d=(await B.get("/perfil")).data;return(o=d.foto_perfil)!=null&&o.url&&(d.foto_perfil.url=_e(d.foto_perfil.url)),d}catch(a){throw new Error(a.response.data.error||"Erro desconhecido ao buscar perfil")}}async update(o,a){try{return(await B.put(`/usuarios/${o}`,a)).data}catch(d){throw new Error(d.response.data.error||"Erro desconhecido ao atualizar usu\xE1rio")}}async editarDados(o){try{return(await B.put("/perfil",o)).data}catch(a){throw new Error(a.response.data.error||"Erro desconhecido ao editar dados")}}async editarBio(o){try{return(await B.put("/perfil",{biografia:o})).data}catch(a){throw new Error(a.response.data.error||"Erro desconhecido ao editar biografia")}}logout(){localStorage.removeItem("authToken")}}var L=new ye;const xe=m=>(W("data-v-cc31fcee"),m=m(),X(),m),he=xe(()=>b("div",{class:"text-h6"},"Adicionar Via",-1)),we=N({__name:"AddPreferidaModal",props:{viaPreferidaId:{}},emits:["viaPreferidaUpdate"],setup(m,{emit:o}){const a=m,d=o,n=s(""),v=s([]),u=s(1),p=s(1),r=s(""),i=()=>{u.value=1,v.value=[]},f=l=>{l.selected=!0,d("viaPreferidaUpdate",l)},w=async()=>{if(i(),n.value.trim()){const l=await le.getAllVias(1,10);v.value=l.vias.filter(P=>P.nome.toLowerCase().includes(n.value.trim().toLowerCase()))}else await V()},V=async()=>{const l=await le.getAllVias(u.value,10);v.value=u.value===1?l.vias:[...v.value,...l.vias],p.value=Math.ceil(l.total/10)},x=async()=>{u.value<p.value&&(u.value+=1,await V())},g=l=>{d("viaPreferidaUpdate",l),l.selected=!0};return oe(()=>a.viaPreferidaId,l=>{l&&(r.value=l)},{immediate:!0}),V(),(l,P)=>(h(),k(A,{class:"q-dialog-plugin"},{default:t(()=>[e(S,null,{default:t(()=>[he,e(I,{modelValue:n.value,"onUpdate:modelValue":P[0]||(P[0]=y=>n.value=y),label:"Buscar vias",onInput:w,debounce:"300"},null,8,["modelValue"]),e(se,{bordered:"",separator:""},{default:t(()=>[(h(!0),U(Y,null,R(v.value,y=>(h(),k(z,{key:y.id,clickable:"",onClick:Q=>g(y)},{default:t(()=>[e($,{avatar:""},{default:t(()=>[e(me,{square:"",size:"50px",class:"custom-avatar"},{default:t(()=>{var Q;return[e(ie,{src:((Q=y.imagem)==null?void 0:Q.url)||"https://via.placeholder.com/50",cover:""},null,8,["src"])]}),_:2},1024)]),_:2},1024),e($,null,{default:t(()=>[e(j,null,{default:t(()=>[M(D(y.nome),1)]),_:2},1024),e(j,{caption:""},{default:t(()=>[M(D(y.montanha.nome),1)]),_:2},1024)]),_:2},1024),e($,{side:""},{default:t(()=>[e(C,{flat:"",round:"",icon:y.selected?"check":"add",color:y.selected?"green":"primary",onClick:re(Q=>f(y),["stop"]),disabled:y.selected},null,8,["icon","color","onClick","disabled"])]),_:2},1024)]),_:2},1032,["onClick"]))),128)),v.value.length?G("",!0):(h(),k(z,{key:0},{default:t(()=>[e($,null,{default:t(()=>[e(j,null,{default:t(()=>[M("Nenhuma via encontrada.")]),_:1})]),_:1})]),_:1}))]),_:1})]),_:1}),e(ne,{align:"center"},{default:t(()=>[u.value<p.value?(h(),k(C,{key:0,onClick:x,label:"Carregar mais"})):G("",!0)]),_:1})]),_:1}))}});var Ee=O(we,[["__scopeId","data-v-cc31fcee"]]);const Ve=m=>(W("data-v-6fcba466"),m=m(),X(),m),Pe=Ve(()=>b("div",{class:"text-h6"},"Editar Dados:",-1)),$e={class:"row"},Ie={class:"col-6 align-center"},ke=N({__name:"PerfilEditaForm",props:{user:{}},emits:["submit","waiting"],setup(m,{emit:o}){var J,K,ee;const a=m,d=o,n=s(a.user.nome),v=s(a.user.email),u=s((J=a.user.foto_perfil)==null?void 0:J.url),p=s(a.user.data_atividade),r=s(a.user.clube_organizacao||""),i=s(a.user.localizacao||""),f=s(a.user.biografia||""),w=s(((K=a.user.via_preferida)==null?void 0:K.id.toString())||""),V=s(((ee=a.user.via_preferida)==null?void 0:ee.nome)||""),x=s(a.user.via_preferida||null),g=s(!1),l=E=>{const[c,_,T]=E.split("/");return`${T}-${_}-${c}`},P=E=>{const c=new Date(E+"T00:00:00"),_=String(c.getDate()).padStart(2,"0"),T=String(c.getMonth()+1).padStart(2,"0"),ce=c.getFullYear();return`${_}/${T}/${ce}`},y=s(p.value?l(p.value):""),Q=E=>{x.value=E,w.value=E.id.toString(),V.value=E.nome,g.value=!1},de=async()=>{try{const E={...a.user,nome:n.value,email:v.value,foto_perfil:u.value?{url:u.value}:null,data_atividade:y.value?P(y.value):null,clube_organizacao:r.value||null,localizacao:i.value||null,biografia:f.value||null,via_preferida:x.value?{id:w.value,nome:V.value}:null};await L.editarDados(E),d("submit",E)}catch(E){console.error(E)}};return(E,c)=>(h(),k(A,{class:"my-card"},{default:t(()=>[e(S,null,{default:t(()=>[Pe]),_:1}),e(S,null,{default:t(()=>[e(be,{onSubmit:re(de,["prevent"])},{default:t(()=>[e(I,{modelValue:n.value,"onUpdate:modelValue":c[0]||(c[0]=_=>n.value=_),label:"Nome",type:"text",required:""},null,8,["modelValue"]),e(I,{modelValue:v.value,"onUpdate:modelValue":c[1]||(c[1]=_=>v.value=_),label:"Email",type:"email",required:""},null,8,["modelValue"]),e(I,{modelValue:y.value,"onUpdate:modelValue":c[2]||(c[2]=_=>y.value=_),label:"Data de Atividade",type:"date"},null,8,["modelValue"]),e(I,{modelValue:r.value,"onUpdate:modelValue":c[3]||(c[3]=_=>r.value=_),label:"Clube ou Organiza\xE7\xE3o",type:"text"},null,8,["modelValue"]),e(I,{modelValue:i.value,"onUpdate:modelValue":c[4]||(c[4]=_=>i.value=_),label:"Localiza\xE7\xE3o",type:"text"},null,8,["modelValue"]),e(I,{modelValue:f.value,"onUpdate:modelValue":c[5]||(c[5]=_=>f.value=_),label:"Biografia",type:"textarea"},null,8,["modelValue"]),e(H,{spaced:""}),b("div",$e,[e(C,{class:"col-6",label:"Via Predileta",color:"secondary",onClick:c[6]||(c[6]=_=>g.value=!0)}),b("div",Ie,D(V.value),1)]),e(H,{spaced:""}),e(C,{flat:"",label:"Alterar Foto de Perfil",class:"q-mt-md right-margem"}),e(C,{type:"submit",label:"Salvar",color:"primary",class:"q-mt-md"})]),_:1}),e(F,{modelValue:g.value,"onUpdate:modelValue":c[7]||(c[7]=_=>g.value=_)},{default:t(()=>[e(Ee,{viaPreferidaId:w.value,onViaPreferidaUpdate:Q},null,8,["viaPreferidaId"])]),_:1},8,["modelValue"])]),_:1})]),_:1}))}});var Ce=O(ke,[["__scopeId","data-v-6fcba466"]]);const Se={class:"profile-header-container no-wrap q-pa-md row items-center shadow-item"},De=["src"],Be={class:"text-h6"},Qe={class:"info-list"},Ue={class:"text-subtitle1 info-text"},Ae=N({__name:"PerfilBar",props:{user:{}},setup(m){const o=m,a=s(""),d=s(!1),n=u=>{a.value=u,d.value=!0},v=Z(()=>{var u,p,r,i,f,w;return[{icon:"mail",text:((u=o.user)==null?void 0:u.email)||"Email n\xE3o dispon\xEDvel"},{icon:"calendar_month",text:`Escalando desde: ${((p=o.user)==null?void 0:p.data_atividade)||"Data n\xE3o dispon\xEDvel"}`},{icon:"groups_2",text:`Meu Clube/Organiza\xE7\xE3o: ${((r=o.user)==null?void 0:r.clube_organizacao)||"N\xE3o dispon\xEDvel"}`},{icon:"perm_media",text:`Minha Predileta: ${((f=(i=o.user)==null?void 0:i.via_preferida)==null?void 0:f.nome)||"N\xE3o dispon\xEDvel"}`},{icon:"flag_circle",text:`De onde eu sou: ${((w=o.user)==null?void 0:w.localizacao)||"Localiza\xE7\xE3o n\xE3o dispon\xEDvel"}`}]});return(u,p)=>(h(),U(Y,null,[b("div",Se,[e(S,null,{default:t(()=>{var r,i;return[b("img",{src:((i=(r=u.user)==null?void 0:r.foto_perfil)==null?void 0:i.url)||"https://via.placeholder.com/150",alt:"Foto de Perfil",class:"profile-picture",onClick:p[0]||(p[0]=f=>{var w,V;return n(((V=(w=u.user)==null?void 0:w.foto_perfil)==null?void 0:V.url)||"https://via.placeholder.com/150")})},null,8,De)]}),_:1}),e(S,{class:"col text-left q-ml-md"},{default:t(()=>{var r;return[b("div",Be,D((r=u.user)==null?void 0:r.nome),1),b("div",Qe,[(h(!0),U(Y,null,R(v.value,(i,f)=>(h(),U("div",{key:f,class:"info-item row items-center"},[e(q,{name:i.icon,class:"small-icon right-margem"},null,8,["name"]),b("div",Ue,D(i.text),1)]))),128))])]}),_:1})]),e(F,{modelValue:d.value,"onUpdate:modelValue":p[1]||(p[1]=r=>d.value=r)},{default:t(()=>[e(ie,{src:a.value,style:{"min-width":"50vw","min-height":"50vh"}},null,8,["src"])]),_:1},8,["modelValue"])],64))}});var Me=O(Ae,[["__scopeId","data-v-427b8f36"]]);const ue=m=>(W("data-v-a0b49a1e"),m=m(),X(),m),qe={class:"row justify-between"},ze=ue(()=>b("div",{class:"text-h5 left-margem"},"Bio",-1)),Fe={class:"text-h6"},Ne=ue(()=>b("div",{class:"text-h6"},"Editar Biografia",-1)),Oe=N({__name:"PerfilBio",props:{user:{}},emits:["bio-updated"],setup(m,{emit:o}){const a=m,d=o,n=s(!1),v=s("");oe(()=>a.user,r=>{r&&(v.value=r.biografia||"")},{immediate:!0});const u=async()=>{try{await L.editarBio(v.value),d("bio-updated",v.value),n.value=!1}catch(r){console.error(r)}},p=Z(()=>{var r;return((r=a.user)==null?void 0:r.biografia)||"Nenhuma biografia dispon\xEDvel."});return(r,i)=>(h(),k(A,{class:"q-pa-md q-mb-md no-wrap top-margem shadow-item border-radius-large"},{default:t(()=>[b("div",qe,[ze,e(q,{name:"edit",class:"medium-icon right-margem",onClick:i[0]||(i[0]=f=>n.value=!0)})]),e(H,{spaced:""}),e(S,{class:"col text-left q-ml-md"},{default:t(()=>[b("div",Fe,D(p.value),1)]),_:1}),e(F,{modelValue:n.value,"onUpdate:modelValue":i[3]||(i[3]=f=>n.value=f)},{default:t(()=>[e(A,null,{default:t(()=>[e(S,null,{default:t(()=>[Ne]),_:1}),e(S,null,{default:t(()=>[e(I,{modelValue:v.value,"onUpdate:modelValue":i[1]||(i[1]=f=>v.value=f),label:"Biografia",type:"textarea"},null,8,["modelValue"])]),_:1}),e(ne,{align:"right"},{default:t(()=>[e(C,{flat:"",label:"Cancelar",onClick:i[2]||(i[2]=f=>n.value=!1)}),e(C,{flat:"",label:"Salvar",color:"primary",onClick:u})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});var Ye=O(Oe,[["__scopeId","data-v-a0b49a1e"]]);const Le={class:"row q-col-gutter-sm q-gutter-md justify-center"},Te={class:"row items-center justify-center"},je=N({name:"PerfilPage",__name:"Perfil",setup(m){const o=pe(),a=s(null),d=s(0),n=s(0),v=s(0),u=s(0),p=s(!1),r=s(!1),i=Z(()=>[{label:"Escaladas",num:n.value,icon:"hiking",color:"blue",to:"/escaladas"},{label:"Cole\xE7\xF5es",num:d.value,icon:"style",color:"purple",to:"/colecoes"},{label:"Favoritas",num:v.value,icon:"star",color:"orange",to:`/colecoes/${u.value}`},{label:"Nova Escalada",num:null,icon:"add_location",color:"green",to:"/colecoes"}]);ve(async()=>{try{if(!ge.isAuthenticated())await o.push("/auth/login");else{a.value=await L.getPerfil();const x=await te.getByUsuarioId(),g=x.filter(P=>P.nome==="Vias Favoritas");u.value=g[0].id;const l=await te.getViasIn(u.value.toString());v.value=l.length,d.value=x.length}}catch(x){console.error(x)}});const f=()=>{L.logout(),o.push("/auth/login")},w=x=>{a.value=x,p.value=!1,r.value=!1},V=x=>{a.value&&(a.value.biografia=x)};return(x,g)=>(h(),k(fe,null,{default:t(()=>[e(C,{icon:"settings",class:"settings-btn",onClick:g[0]||(g[0]=l=>r.value=!0),color:"primary"}),e(Me,{user:a.value},null,8,["user"]),e(A,{class:"q-pa-md q-mb-md no-wrap top-margem shadow-item border-radius-large"},{default:t(()=>[b("div",Le,[(h(!0),U(Y,null,R(i.value,(l,P)=>(h(),U("div",{key:P,class:"col-xs-5 col-sm-3 col-md-3 col-lg-2 col-xl-2"},[e(z,{flat:"",label:l.label,clickable:"",to:l.to,class:"shadow-item box-item"},{default:t(()=>[e($,{class:"q-column items-center text-center"},{default:t(()=>[b("div",Te,[b("div",{style:ae({color:l.color}),class:"large-text"},D(l.num),5),e(q,{color:l.color,name:l.icon,class:"large-icon left-margem"},null,8,["color","name"])]),b("div",{class:"text-h5",style:ae({color:l.color})},D(l.label),5)]),_:2},1024)]),_:2},1032,["label","to"])]))),128))])]),_:1}),e(F,{modelValue:r.value,"onUpdate:modelValue":g[2]||(g[2]=l=>r.value=l)},{default:t(()=>[e(A,null,{default:t(()=>[e(se,null,{default:t(()=>[e(z,{flat:"",label:"Editar Dados",clickable:"",onClick:g[1]||(g[1]=l=>p.value=!0)},{default:t(()=>[e($,{avatar:""},{default:t(()=>[e(q,{name:"edit"})]),_:1}),e($,null,{default:t(()=>[M("Editar Dados")]),_:1})]),_:1}),e(z,{flat:"",label:"Logout",clickable:"",onClick:f},{default:t(()=>[e($,{avatar:""},{default:t(()=>[e(q,{name:"logout",color:"negative"})]),_:1}),e($,null,{default:t(()=>[M("Logout")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(F,{modelValue:p.value,"onUpdate:modelValue":g[3]||(g[3]=l=>p.value=l)},{default:t(()=>[a.value?(h(),k(Ce,{key:0,user:a.value,onSubmit:w},null,8,["user"])):G("",!0)]),_:1},8,["modelValue"]),e(Ye,{user:a.value,onBioUpdated:V},null,8,["user"])]),_:1}))}});var sa=O(je,[["__scopeId","data-v-b9d1542a"]]);export{sa as default};
